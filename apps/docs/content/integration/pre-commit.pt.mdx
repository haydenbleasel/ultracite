---
title: pre-commit
description: Executar automaticamente o Ultracite nos seus ficheiros staged do Git com pre-commit
---

Ultracite fornece integração transparente com [pre-commit](https://pre-commit.com/), um framework popular em Python para gerir hooks do Git. Esta integração configura automaticamente hooks do pre-commit para garantir que o seu código está corretamente formatado antes de cada commit.

## O que é o pre-commit?

pre-commit é um framework para gerir e manter hooks de pre-commit multilíngue. É amplamente utilizado no ecossistema Python, mas suporta hooks para qualquer linguagem. O pre-commit utiliza um ficheiro `.pre-commit-config.yaml` para definir quais hooks executar e quando.

## Como o Ultracite Usa o pre-commit

Quando inicializa o Ultracite no seu projeto, ele pode configurar automaticamente o pre-commit para executar a formatação de código antes de cada commit. Isto garante que:

- **Todo o código enviado no commit segue padrões de formatação consistentes**
- **Verificações de qualidade de código são aplicadas automaticamente**
- **Os membros da equipa não precisam lembrar-se de formatar o código manualmente**
- **O seu repositório mantém um estilo de código limpo e consistente**

## Comportamento do Hook do Pre-commit

A integração do pre-commit do Ultracite cria um hook local que executa o seguinte comando:

```bash
npx ultracite fix
```

Este comando:
- Executa o linter e o formatador do Biome no seu código
- Corrige automaticamente problemas de formatação sempre que possível
- Garante que todos os ficheiros staged cumprem os padrões de código do seu projeto
- Evita commits que introduzam inconsistências de formatação

## Configuração Automática

Durante o processo de inicialização (`ultracite init`), se selecionar a opção pre-commit, o Ultracite:

1. **Cria Ficheiro de Configuração**: Configura o ficheiro `.pre-commit-config.yaml` com o hook do Ultracite
2. **Trata Configurações Existentes**: Se já tiver o pre-commit configurado, adiciona o hook do Ultracite à sua configuração existente em vez de a sobrescrever

## Configuração Gerada

O Ultracite gera o seguinte `.pre-commit-config.yaml`:

```yaml
repos:
  - repo: local
    hooks:
      - id: ultracite
        name: ultracite
        entry: npx ultracite fix
        language: system
        types_or: [javascript, jsx, ts, tsx, json, css]
        pass_filenames: false
```

### Explicação da Configuração

- **repo: local** - Usa um hook definido localmente em vez de o buscar de um repositório remoto
- **id: ultracite** - Identificador único para o hook
- **name: ultracite** - Nome exibido quando o hook é executado
- **entry** - O comando a executar (usa npx para correr o Ultracite)
- **language: system** - Usa as ferramentas instaladas no sistema
- **types_or** - Tipos de ficheiros que disparam o hook
- **pass_filenames: false** - Executa uma vez para todos os ficheiros em vez de por ficheiro

## Pré-requisitos

Antes de usar a integração com o pre-commit, vai precisar de:

1. **Python instalado** - o pre-commit é um pacote Python
2. **pre-commit instalado** - Instale globalmente ou num ambiente virtual:
   ```bash
   pip install pre-commit
   # or
   pipx install pre-commit
   ```
3. **Inicializar os hooks** - Depois do Ultracite criar a config, execute:
   ```bash
   pre-commit install
   ```

## Benefícios

### Estilo de Código Consistente
Cada commit segue automaticamente os padrões de formatação do seu projeto, eliminando debates sobre estilo e inconsistências.

### Controlo de Qualidade Automatizado
Detete problemas de formatação antes de entrarem no seu repositório, mantendo um histórico de commits limpo.

### Colaboração de Equipa
Todos os membros da equipa seguem automaticamente os mesmos padrões de formatação sem intervenção manual.

### Optimização de CI/CD
Reduza falhas na pipeline CI/CD devido a questões de formatação, já que o código é pré-formatado localmente.

### Suporte Multilíngue
Se o seu projeto usa várias linguagens, o pre-commit pode gerir hooks para todas elas num único ficheiro de configuração.

## Integração no Fluxo de Trabalho

Com a integração pre-commit ativada, o seu fluxo de trabalho Git típico torna-se:

1. **Faça alterações** nos seus ficheiros de código
2. **Prepare as alterações** com `git add`
3. **Commit as alterações** com `git commit`
4. **O hook pre-commit é executado** automaticamente, formatando os ficheiros staged
5. **O commit prossegue** com o código corretamente formatado

Se o formatador fizer alterações, terá de preparar (stage) e commitar essas alterações também.

## Personalização

Embora o Ultracite configure valores predefinidos sensatos, pode personalizar o comportamento:

- Adicione hooks adicionais do [repositório de hooks do pre-commit](https://pre-commit.com/hooks.html)
- Configure as definições do Biome para ajustar as regras de formatação
- Modifique o filtro `types_or` para incluir/excluir tipos de ficheiros
- Adicione padrões `exclude` para omitir certos ficheiros

### Exemplo de Configuração Estendida

```yaml
repos:
  - repo: local
    hooks:
      - id: ultracite
        name: ultracite
        entry: npx ultracite fix
        language: system
        types_or: [javascript, jsx, ts, tsx, json, css]
        pass_filenames: false
        exclude: ^(vendor/|dist/)
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
```

## Resolução de Problemas

### Hook não está a ser executado
Se o hook pre-commit não estiver a executar:
- Verifique se o pre-commit está instalado: `pre-commit --version`
- Execute `pre-commit install` para configurar os hooks do Git
- Verifique se o ficheiro `.pre-commit-config.yaml` existe na raiz do seu projeto

### Node.js não encontrado
Se receber erros sobre o npx não ser encontrado:
- Certifique-se de que o Node.js está no seu PATH
- Considere usar um ficheiro `.nvmrc` ou `.node-version` para gestão de versões

### Contornar Hooks
Em casos raros em que precisa de saltar o hook pre-commit:
```bash
git commit --no-verify
# or
git commit -n
```

Use isto com moderação, pois contorna a formatação automática que mantém a consistência do seu código.

### Executar Hooks Manualmente
Para executar os hooks manualmente em todos os ficheiros:
```bash
pre-commit run --all-files
```

Para executar apenas o hook do Ultracite:
```bash
pre-commit run ultracite --all-files
```