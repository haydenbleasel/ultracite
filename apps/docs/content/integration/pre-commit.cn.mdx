---
title: pre-commit
description: 使用 pre-commit 在已暂存的 Git 文件上自动运行 Ultracite
---

Ultracite 无缝集成了 [pre-commit](https://pre-commit.com/)，这是一个流行的基于 Python 的 Git 钩子管理框架。此集成会自动设置 pre-commit 钩子，以确保你的代码在每次提交前都已正确格式化。

## 什么是 pre-commit？

pre-commit 是一个用于管理和维护多语言 pre-commit 钩子的框架。它在 Python 生态系统中被广泛使用，但也支持任何语言的钩子。pre-commit 使用 `.pre-commit-config.yaml` 文件来定义要在何时运行哪些钩子。

## Ultracite 如何使用 pre-commit

当你在项目中初始化 Ultracite 时，它可以自动配置 pre-commit，以在每次提交前运行代码格式化。这可确保：

- 所有提交的代码遵循一致的格式标准
- 自动执行代码质量检查
- 团队成员无需记住手动格式化代码
- 仓库保持干净且一致的代码风格

## Pre-commit 钩子行为

Ultracite 的 pre-commit 集成会创建一个本地钩子，运行以下命令：

```bash
npx ultracite fix
```

该命令：
- 运行 Biome 的 linter 和格式化器
- 在可能的情况下自动修复格式问题
- 确保所有已暂存的文件符合你项目的代码标准
- 防止引入格式不一致的提交

## 自动设置

在初始化过程中（`ultracite init`），如果你选择 pre-commit 选项，Ultracite 将会：

1. **创建配置文件**：设置包含 Ultracite 钩子的 `.pre-commit-config.yaml` 文件
2. **处理已有配置**：如果你已有 pre-commit 配置，它会将 Ultracite 钩子添加到现有配置中，而不是覆盖它

## 生成的配置

Ultracite 会生成以下 `.pre-commit-config.yaml`：

```yaml
repos:
  - repo: local
    hooks:
      - id: ultracite
        name: ultracite
        entry: npx ultracite fix
        language: system
        types_or: [javascript, jsx, ts, tsx, json, css]
        pass_filenames: false
```

### 配置说明

- **repo: local** - 使用本地定义的钩子，而不是从远程仓库获取
- **id: ultracite** - 钩子的唯一标识符
- **name: ultracite** - 钩子运行时显示的名称
- **entry** - 要执行的命令（使用 npx 来运行 Ultracite）
- **language: system** - 使用系统已安装的工具
- **types_or** - 触发该钩子的文件类型
- **pass_filenames: false** - 对所有文件只运行一次，而不是每个文件单独运行

## 先决条件

在使用 pre-commit 集成之前，你需要：

1. **已安装 Python** - pre-commit 是一个 Python 包
2. **已安装 pre-commit** - 全局安装或在虚拟环境中安装：
   ```bash
   pip install pre-commit
   # or
   pipx install pre-commit
   ```
3. **初始化钩子** - 在 Ultracite 创建配置后运行：
   ```bash
   pre-commit install
   ```

## 优势

### 一致的代码风格
每次提交都会自动遵循你项目的格式标准，消除风格争论和不一致。

### 自动化质量控制
在格式问题进入仓库之前捕获它们，保持干净的提交历史。

### 团队协作
所有团队成员在不需要手动干预的情况下，自动遵循相同的格式标准。

### CI/CD 优化
减少因格式问题导致的 CI/CD 管道失败，因为代码在本地已预先格式化。

### 多语言支持
如果你的项目使用多种语言，pre-commit 可以在一个配置文件中管理所有语言的钩子。

## 工作流集成

启用 pre-commit 集成后，你的典型 Git 工作流会变为：

1. **修改** 你的代码文件
2. 使用 `git add` **暂存更改**
3. 使用 `git commit` **提交更改**
4. **pre-commit 钩子自动运行**，格式化已暂存的文件
5. **提交继续**，代码已正确格式化

如果格式化工具进行了更改，你需要重新暂存并提交这些更改。

## 自定义

虽然 Ultracite 设置了合理的默认值，但你可以自定义行为：

- 从 [pre-commit 钩子仓库](https://pre-commit.com/hooks.html) 添加额外的钩子
- 配置 Biome 设置以调整格式化规则
- 修改 `types_or` 过滤器以包含/排除文件类型
- 添加 `exclude` 模式以跳过某些文件

### 扩展示例配置

```yaml
repos:
  - repo: local
    hooks:
      - id: ultracite
        name: ultracite
        entry: npx ultracite fix
        language: system
        types_or: [javascript, jsx, ts, tsx, json, css]
        pass_filenames: false
        exclude: ^(vendor/|dist/)
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
```

## 故障排除

### 钩子未运行
如果 pre-commit 钩子未执行：
- 确认已安装 pre-commit：`pre-commit --version`
- 运行 `pre-commit install` 以设置 Git 钩子
- 检查项目根目录下是否存在 `.pre-commit-config.yaml`

### 未找到 Node.js
如果出现关于找不到 npx 的错误：
- 确认 Node.js 在你的 PATH 中
- 考虑使用 `.nvmrc` 或 `.node-version` 文件进行版本管理

### 绕过钩子
在极少数需要跳过 pre-commit 钩子的情况下：
```bash
git commit --no-verify
# or
git commit -n
```

请谨慎使用，因为这会绕过自动格式化，从而可能破坏代码库一致性。

### 手动运行钩子
要在所有文件上手动运行钩子：
```bash
pre-commit run --all-files
```

要仅运行 Ultracite 钩子：
```bash
pre-commit run ultracite --all-files
```